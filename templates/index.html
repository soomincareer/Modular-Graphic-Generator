<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Grid Generator</title>
    <style>
        @font-face {
            font-family: 'Superlative';
            src: url('/static/fonts/Superlative-RegularCondensed.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'Superlative Regular';
            src: url('/static/fonts/Superlative-Regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Superlative', sans-serif;
            background: #000000;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border: 2px solid #000000;
            box-shadow: 0 0 0 rgba(0, 0, 0, 0);
            overflow: hidden;
        }

        .header {
            background: #000000;
            color: #ffffff;
            padding: 30px;
            text-align: center;
            border-bottom: 2px solid #000000;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: normal;
            font-family: 'Superlative Regular', sans-serif;
        }

        .header p {
            opacity: 1;
            font-size: 1.1em;
            font-weight: normal;
        }

        .content {
            padding: 40px;
            background: #ffffff;
        }

        .section {
            margin-bottom: 40px;
            border: 2px solid #000000;
            padding: 20px;
            background: #ffffff;
        }

        .section h2 {
            color: #000000;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #000000;
            padding-bottom: 10px;
            font-weight: normal;
            font-family: 'Superlative Regular', sans-serif;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: normal;
            margin-bottom: 10px;
            color: #000000;
            font-family: 'Superlative', sans-serif;
        }

        .form-group input[type="text"],
        .form-group input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #000000;
            border-radius: 0;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: 'Superlative', sans-serif;
            background: #DDDDDD;
        }

        .form-group input:focus {
            outline: none;
            border-color: #000000;
            background: #f5f5f5;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            display: none;
        }

        .file-input-label {
            display: block;
            padding: 15px 25px;
            background: #AFAFAF;
            color: #ffffff;
            border: 2px solid #515151;
            border-radius: 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Superlative', sans-serif;
            font-weight: normal;
        }

        .file-input-label:hover {
            background: #000000;
            color: #ffffff;
            border-color: #000000;
        }

        .file-input-label.has-files {
            background: #000000;
            border-color: #000000;
            color: #ffffff;
        }

        .btn {
            padding: 15px 30px;
            border: 2px solid #000000;
            border-radius: 0;
            font-size: 16px;
            font-weight: normal;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            font-family: 'Superlative', sans-serif;
        }

        .btn-primary {
            background: #000000;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #ffffff;
            color: #000000;
            border-color: #000000;
        }

        .btn-primary:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #ffffff;
            color: #000000;
            border: 2px solid #000000;
            margin-left: 10px;
        }

        .btn-secondary:hover {
            background: #000000;
            color: #ffffff;
        }

        .module-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .module-item {
            background: #ffffff;
            border: 2px solid #000000;
            border-radius: 0;
            padding: 10px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
        }

        .module-item:hover {
            background: #000000;
            color: #ffffff;
        }

        .module-item:hover .filename,
        .module-item:hover .brightness {
            color: #ffffff;
        }

        .module-item img {
            width: 100%;
            height: 120px;
            object-fit: contain;
            border-radius: 0;
            background: #ffffff;
            margin-bottom: 8px;
            border: 1px solid #000000;
        }

        .module-item .filename {
            font-size: 12px;
            color: #000000;
            word-break: break-all;
            margin-bottom: 5px;
            font-family: 'Superlative', sans-serif;
        }

        .module-item .brightness {
            font-size: 11px;
            color: #000000;
            font-weight: normal;
            font-family: 'Superlative', sans-serif;
        }

        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #000000;
            color: #ffffff;
            border: 2px solid #000000;
            border-radius: 0;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-family: 'Superlative', sans-serif;
        }

        .remove-btn:hover {
            background: #ffffff;
            color: #000000;
        }

        .target-item {
            background: #ffffff;
            border: 2px solid #000000;
            border-radius: 0;
            padding: 10px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
        }

        .target-item:hover {
            background: #000000;
            color: #ffffff;
        }

        .target-item:hover .filename {
            color: #ffffff;
        }

        .target-item img {
            width: 100%;
            height: 120px;
            object-fit: contain;
            border-radius: 0;
            background: #ffffff;
            margin-bottom: 8px;
            border: 1px solid #000000;
        }

        .target-item .filename {
            font-size: 12px;
            color: #000000;
            word-break: break-all;
            font-family: 'Superlative', sans-serif;
        }

        .target-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #ffffff;
            border-top: 4px solid #000000;
            border-radius: 0;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-section {
            display: none;
            margin-top: 40px;
        }

        .result-section.active {
            display: block;
        }

        .markdown-preview {
            background: #ffffff;
            border: 2px solid #000000;
            border-radius: 0;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
            font-size: 14px;
            font-family: 'Superlative', sans-serif;
        }

        .markdown-preview h1 {
            color: #000000;
            margin-bottom: 20px;
            font-weight: normal;
            font-family: 'Superlative Regular', sans-serif;
        }

        .markdown-preview h2 {
            color: #000000;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: normal;
            font-family: 'Superlative Regular', sans-serif;
        }

        .markdown-preview table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .markdown-preview th,
        .markdown-preview td {
            padding: 10px;
            border: 1px solid #000000;
            text-align: left;
        }

        .markdown-preview th {
            background: #000000;
            color: #ffffff;
        }

        .markdown-preview img {
            max-width: 200px;
            max-height: 200px;
            object-fit: contain;
            border: 1px solid #000000;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 0;
            margin-bottom: 20px;
            border: 2px solid #000000;
            font-family: 'Superlative', sans-serif;
        }

        .alert-error {
            background: #ffffff;
            color: #000000;
            border: 2px solid #000000;
        }

        .alert-success {
            background: #000000;
            color: #ffffff;
            border: 2px solid #000000;
        }

        .file-count {
            display: inline-block;
            margin-left: 10px;
            padding: 5px 10px;
            background: #000000;
            color: #ffffff;
            border-radius: 0;
            font-size: 12px;
            font-weight: normal;
            font-family: 'Superlative', sans-serif;
        }

        .grid-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .helper-text {
            font-size: 12px;
            color: #666666;
            margin-top: 5px;
            font-family: 'Superlative', sans-serif;
        }

        .image-viewer {
            margin-top: 30px;
            border: 2px solid #000000;
            padding: 20px;
            background: #ffffff;
        }

        .image-viewer h3 {
            font-family: 'Superlative Regular', sans-serif;
            margin-bottom: 20px;
            font-weight: normal;
        }

        .image-display {
            text-align: center;
            margin: 20px 0;
            background: #f5f5f5;
            border: 2px solid #000000;
            padding: 20px;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-display img {
            max-width: 100%;
            max-height: 600px;
            object-fit: contain;
            border: 1px solid #000000;
        }

        .image-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .image-nav-btn {
            padding: 10px 20px;
            background: #000000;
            color: #ffffff;
            border: 2px solid #000000;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Superlative', sans-serif;
            transition: all 0.3s;
        }

        .image-nav-btn:hover:not(:disabled) {
            background: #ffffff;
            color: #000000;
        }

        .image-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .image-counter {
            font-family: 'Superlative', sans-serif;
            font-size: 16px;
        }

        .toggle-btn {
            padding: 10px 20px;
            background: #ffffff;
            color: #000000;
            border: 2px solid #000000;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Superlative', sans-serif;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .toggle-btn:hover {
            background: #000000;
            color: #ffffff;
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-content.active {
            max-height: 1000px;
            transition: max-height 0.5s ease-in;
        }

        .download-image-btn {
            padding: 10px 20px;
            background: #000000;
            color: #ffffff;
            border: 2px solid #000000;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Superlative', sans-serif;
            transition: all 0.3s;
        }

        .download-image-btn:hover {
            background: #ffffff;
            color: #000000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Happy New Year! 2026</h1>
            <p>Modular Graphic Generator</p>
        </div>

        <div class="content">
            <!-- Input Section -->
            <div class="section">
                <h2>1. Upload Module Images</h2>
                <div class="form-group">
                    <label>Module Folder (Multiple Selection)</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="moduleFiles" multiple accept="image/*">
                        <label for="moduleFiles" class="file-input-label" id="moduleLabel">
                            Click to select module images
                        </label>
                    </div>
                    <p class="helper-text">Select image files (PNG, JPG, JPEG, etc.)</p>
                </div>

                <!-- Module Preview -->
                <div id="modulePreview" class="module-preview"></div>
            </div>

            <div class="section">
                <h2>2. Upload Target Images</h2>
                <div class="form-group">
                    <label>Target Images (Multiple Selection)</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="targetFiles" multiple accept="image/*">
                        <label for="targetFiles" class="file-input-label" id="targetLabel">
                            Click to select target images
                        </label>
                    </div>
                    <p class="helper-text">Select images to convert</p>
                </div>

                <!-- Target Preview -->
                <div id="targetPreview" class="target-preview"></div>
            </div>

            <div class="section">
                <h2>3. Configuration</h2>
                <div class="grid-inputs">
                    <div class="form-group">
                        <label>Grid Size</label>
                        <input type="text" id="gridSize" value="64x40" placeholder="e.g. 64x40">
                        <p class="helper-text">Width x Height (e.g. 64x40)</p>
                    </div>
                    <div class="form-group">
                        <label>Output DPI</label>
                        <input type="number" id="outputDpi" value="600" min="72" max="1200">
                        <p class="helper-text">Range: 72 ~ 1200</p>
                    </div>
                </div>
            </div>

            <div class="section" style="text-align: center; border: none;">
                <button class="btn btn-primary" id="generateBtn" disabled>
                    Generate Image
                </button>
            </div>

            <!-- Loading -->
            <div class="loading" id="loadingSection">
                <div class="spinner"></div>
                <p>Generating images... Please wait...</p>
            </div>

            <!-- Result Section -->
            <div class="result-section" id="resultSection">
                <h2>Results</h2>
                <div id="alertBox"></div>

                <!-- Image Viewer -->
                <div class="image-viewer">
                    <h3>Generated Images</h3>
                    <div class="image-display" id="imageDisplay">
                        <p>No images to display</p>
                    </div>
                    <div class="image-controls">
                        <button class="image-nav-btn" id="prevBtn" disabled>&larr; Previous</button>
                        <span class="image-counter" id="imageCounter">0 / 0</span>
                        <button class="image-nav-btn" id="nextBtn" disabled>Next &rarr;</button>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="download-image-btn" id="downloadCurrentImageBtn" style="display: none;">
                            Download Current Image
                        </button>
                        <button class="download-image-btn" id="downloadAllImagesBtn" style="display: none; margin-left: 10px;">
                            Download All Images
                        </button>
                    </div>
                </div>

                <!-- Toggle for detailed results -->
                <div style="text-align: center; margin-top: 30px;">
                    <button class="toggle-btn" id="toggleDetailsBtn">
                        Show Detailed Statistics
                    </button>
                </div>

                <div class="collapsible-content" id="detailsContent">
                    <div class="form-group" style="margin-top: 20px;">
                        <button class="btn btn-secondary" id="downloadMdBtn">
                            Download total.md
                        </button>
                        <button class="btn btn-secondary" id="downloadResultsBtn">
                            Download All Results (ZIP)
                        </button>
                    </div>

                    <div class="markdown-preview" id="markdownPreview"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // 파일 저장소 (DataTransfer 사용)
        let moduleFileList = new DataTransfer();
        let targetFileList = new DataTransfer();

        // DOM 요소
        const moduleFilesInput = document.getElementById('moduleFiles');
        const targetFilesInput = document.getElementById('targetFiles');
        const moduleLabel = document.getElementById('moduleLabel');
        const targetLabel = document.getElementById('targetLabel');
        const generateBtn = document.getElementById('generateBtn');
        const modulePreview = document.getElementById('modulePreview');
        const targetPreview = document.getElementById('targetPreview');

        // 모듈 파일 선택 핸들러
        moduleFilesInput.addEventListener('change', async (e) => {
            if (e.target.files.length === 0) {
                // 취소한 경우 - 기존 파일 유지
                e.target.files = moduleFileList.files;
                return;
            }

            // 새로운 파일 추가
            for (let file of e.target.files) {
                // 중복 확인
                let isDuplicate = false;
                for (let existingFile of moduleFileList.files) {
                    if (existingFile.name === file.name && existingFile.size === file.size) {
                        isDuplicate = true;
                        break;
                    }
                }
                if (!isDuplicate) {
                    moduleFileList.items.add(file);
                }
            }

            // input에 업데이트된 파일 목록 설정
            e.target.files = moduleFileList.files;

            updateModuleUI();
            await analyzeModules();
            checkFormValid();
        });

        // 타겟 파일 선택 핸들러
        targetFilesInput.addEventListener('change', (e) => {
            if (e.target.files.length === 0) {
                // 취소한 경우 - 기존 파일 유지
                e.target.files = targetFileList.files;
                return;
            }

            // 새로운 파일 추가
            for (let file of e.target.files) {
                // 중복 확인
                let isDuplicate = false;
                for (let existingFile of targetFileList.files) {
                    if (existingFile.name === file.name && existingFile.size === file.size) {
                        isDuplicate = true;
                        break;
                    }
                }
                if (!isDuplicate) {
                    targetFileList.items.add(file);
                }
            }

            // input에 업데이트된 파일 목록 설정
            e.target.files = targetFileList.files;

            updateTargetUI();
            checkFormValid();
        });

        function updateModuleUI() {
            const count = moduleFileList.files.length;
            if (count > 0) {
                moduleLabel.textContent = `${count} module images selected`;
                moduleLabel.classList.add('has-files');
            } else {
                moduleLabel.textContent = 'Click to select module images';
                moduleLabel.classList.remove('has-files');
            }
        }

        function updateTargetUI() {
            const count = targetFileList.files.length;
            if (count > 0) {
                targetLabel.textContent = `${count} target images selected`;
                targetLabel.classList.add('has-files');
            } else {
                targetLabel.textContent = 'Click to select target images';
                targetLabel.classList.remove('has-files');
            }

            // 타겟 미리보기 업데이트
            targetPreview.innerHTML = '';
            for (let i = 0; i < targetFileList.files.length; i++) {
                const file = targetFileList.files[i];
                const item = document.createElement('div');
                item.className = 'target-item';

                const reader = new FileReader();
                reader.onload = (e) => {
                    item.innerHTML = `
                        <button class="remove-btn" onclick="removeTargetFile(${i})" title="Remove">×</button>
                        <img src="${e.target.result}" alt="${file.name}">
                        <div class="filename">${file.name}</div>
                    `;
                };
                reader.readAsDataURL(file);

                targetPreview.appendChild(item);
            }
        }

        function removeModuleFile(index) {
            const newFileList = new DataTransfer();
            for (let i = 0; i < moduleFileList.files.length; i++) {
                if (i !== index) {
                    newFileList.items.add(moduleFileList.files[i]);
                }
            }
            moduleFileList = newFileList;
            moduleFilesInput.files = moduleFileList.files;

            updateModuleUI();
            analyzeModules();
            checkFormValid();
        }

        function removeTargetFile(index) {
            const newFileList = new DataTransfer();
            for (let i = 0; i < targetFileList.files.length; i++) {
                if (i !== index) {
                    newFileList.items.add(targetFileList.files[i]);
                }
            }
            targetFileList = newFileList;
            targetFilesInput.files = targetFileList.files;

            updateTargetUI();
            checkFormValid();
        }

        function checkFormValid() {
            const hasModules = moduleFileList.files.length > 0;
            const hasTargets = targetFileList.files.length > 0;
            generateBtn.disabled = !(hasModules && hasTargets);
        }

        // 모듈 분석
        async function analyzeModules() {
            if (moduleFileList.files.length === 0) {
                modulePreview.innerHTML = '';
                return;
            }

            const formData = new FormData();
            for (let file of moduleFileList.files) {
                formData.append('module_files', file);
            }

            try {
                const response = await fetch('/api/analyze-modules', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    // 모듈 미리보기 표시
                    modulePreview.innerHTML = '';
                    data.modules.forEach((module, index) => {
                        const item = document.createElement('div');
                        item.className = 'module-item';
                        item.innerHTML = `
                            <button class="remove-btn" onclick="removeModuleFile(${index})" title="Remove">×</button>
                            <img src="data:image/png;base64,${module.image}" alt="${module.filename}">
                            <div class="filename">${module.filename}</div>
                            <div class="brightness">Brightness: ${module.brightness.toFixed(1)}</div>
                        `;
                        modulePreview.appendChild(item);
                    });
                } else {
                    alert('Module analysis failed: ' + data.error);
                }
            } catch (error) {
                console.error('Error analyzing modules:', error);
                alert('An error occurred while analyzing modules.');
            }
        }

        // 생성 버튼
        generateBtn.addEventListener('click', async () => {
            const loadingSection = document.getElementById('loadingSection');
            const resultSection = document.getElementById('resultSection');
            const alertBox = document.getElementById('alertBox');
            const markdownPreview = document.getElementById('markdownPreview');

            // 로딩 표시
            loadingSection.classList.add('active');
            resultSection.classList.remove('active');
            generateBtn.disabled = true;

            const formData = new FormData();

            // 모듈 파일
            for (let file of moduleFileList.files) {
                formData.append('module_files', file);
            }

            // 타겟 파일
            for (let file of targetFileList.files) {
                formData.append('target_files', file);
            }

            // 설정
            formData.append('grid_size', document.getElementById('gridSize').value);
            formData.append('output_dpi', document.getElementById('outputDpi').value);

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                loadingSection.classList.remove('active');
                resultSection.classList.add('active');

                if (data.success) {
                    alertBox.innerHTML = `
                        <div class="alert alert-success">
                            Generation complete! ${data.output_count} files created.
                        </div>
                    `;

                    // 이미지 목록 업데이트
                    generatedImages = data.output_files || [];
                    currentImageIndex = 0;
                    updateImageViewer();

                    // Markdown 렌더링
                    markdownPreview.innerHTML = marked.parse(data.total_md);
                } else {
                    alertBox.innerHTML = `
                        <div class="alert alert-error">
                            Error: ${data.error}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error generating:', error);
                loadingSection.classList.remove('active');
                resultSection.classList.add('active');
                alertBox.innerHTML = `
                    <div class="alert alert-error">
                        An error occurred during generation: ${error.message}
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
            }
        });

        // 이미지 뷰어 관련 변수
        let generatedImages = [];
        let currentImageIndex = 0;

        // 이미지 뷰어 업데이트
        function updateImageViewer() {
            const imageDisplay = document.getElementById('imageDisplay');
            const imageCounter = document.getElementById('imageCounter');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const downloadBtn = document.getElementById('downloadCurrentImageBtn');
            const downloadAllBtn = document.getElementById('downloadAllImagesBtn');

            if (generatedImages.length === 0) {
                imageDisplay.innerHTML = '<p>No images to display</p>';
                imageCounter.textContent = '0 / 0';
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                downloadBtn.style.display = 'none';
                downloadAllBtn.style.display = 'none';
                return;
            }

            const currentImage = generatedImages[currentImageIndex];
            imageDisplay.innerHTML = `<img src="/outputs/${currentImage}" alt="Generated Image ${currentImageIndex + 1}">`;
            imageCounter.textContent = `${currentImageIndex + 1} / ${generatedImages.length}`;

            prevBtn.disabled = currentImageIndex === 0;
            nextBtn.disabled = currentImageIndex === generatedImages.length - 1;
            downloadBtn.style.display = 'inline-block';
            downloadAllBtn.style.display = 'inline-block';
        }

        // 이미지 네비게이션
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentImageIndex > 0) {
                currentImageIndex--;
                updateImageViewer();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentImageIndex < generatedImages.length - 1) {
                currentImageIndex++;
                updateImageViewer();
            }
        });

        // 현재 이미지 다운로드
        document.getElementById('downloadCurrentImageBtn').addEventListener('click', () => {
            if (generatedImages.length > 0) {
                const currentImage = generatedImages[currentImageIndex];
                const link = document.createElement('a');
                link.href = `/outputs/${currentImage}`;
                link.download = currentImage;
                link.click();
            }
        });

        // 전체 이미지 다운로드 (ZIP)
        document.getElementById('downloadAllImagesBtn').addEventListener('click', async () => {
            if (generatedImages.length === 0) return;

            try {
                // ZIP 파일 다운로드 (기존 API 사용)
                window.location.href = '/api/download-results';
            } catch (error) {
                console.error('Error downloading all images:', error);
                alert('An error occurred while downloading images.');
            }
        });

        // 토글 버튼
        document.getElementById('toggleDetailsBtn').addEventListener('click', () => {
            const detailsContent = document.getElementById('detailsContent');
            const toggleBtn = document.getElementById('toggleDetailsBtn');

            if (detailsContent.classList.contains('active')) {
                detailsContent.classList.remove('active');
                toggleBtn.textContent = 'Show Detailed Statistics';
            } else {
                detailsContent.classList.add('active');
                toggleBtn.textContent = 'Hide Detailed Statistics';
            }
        });

        // 다운로드 버튼
        document.getElementById('downloadMdBtn').addEventListener('click', () => {
            window.location.href = '/api/download-md';
        });

        document.getElementById('downloadResultsBtn').addEventListener('click', () => {
            window.location.href = '/api/download-results';
        });
    </script>
</body>
</html>
